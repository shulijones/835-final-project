<script src="https://unpkg.com/vue@3"></script>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>


<div id="app">
  <h1>Picture Hanging Helper -- Prototype</h1>
  <h2>Developed by Shuli Jones and Emily Caragay</h2>
  <p>What we just heard you say: {{ speech }}</p>
  <p>You are currently in mode: {{ mode }} </p>

  <p>Your video:</p>
  <img :src=src_string>
  
  <div v-if="single_image">
    Your picture:
    <img :src=single_image>
  </div>
  
  <p>To switch to color tracking mode, say "color". To switch to default mode
    (no color tracking), say "default". To take a picture of your current video
    and save the picture frame you're holding up, say "take a picture".
  </p>
</div>

<script>
  Vue.createApp({
    data() {
      return {
        speech: '[No speech yet!]',
        single_image: "",
        src_string: 'http://localhost:8080/api/video_feed',
        mode: 'default'
      }
    },
    methods: {
    },
    mounted() {
      var recognition = new webkitSpeechRecognition();
      recognition.continuous = true;
      recognition.interimResults = true;
      recognition.onresult = (event) => { 
        // note: arrow function syntax is crucial so that 'this' keeps larger scope
        this.speech = event.results[event.results.length-1][0].transcript;

        if (this.speech.includes("color")){
          this.mode = "color tracking";
          this.src_string = 'http://localhost:8080/api/video_feed_color';
        } else if (this.speech.includes("default")) {
          this.mode = "default";
          this.src_string = 'http://localhost:8080/api/video_feed';
        } else if (this.speech.includes("take picture") ||
                  this.speech.includes("take a picture") ) {
          axios.get('http://localhost:8080/api/get_picture')
            .then((response) => {
              this.single_image = "data:image/jpg;base64," + response.data
            })
            .catch((error) => {
            console.log(error)
        });
        }
      }
      recognition.onend = function(event) {
        setTimeout(function() {
          recognition.start();
        }, 1000);
      };
      recognition.start();
    }
  }).mount('#app')
</script>